<!doctype html><html lang="en" data-bs-theme="light"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Part 17 of 12-Week BusinessMath Series"><meta name="author" content="Justin Purnell"><meta name="generator" content="Ignite v0.2.1"><title>Investment Analysis with NPV and IRR</title><link href="/css/bootstrap.min.css" rel="stylesheet"><link href="/css/prism-default-dark.css" rel="stylesheet"><link href="/css/bootstrap-icons.min.css" rel="stylesheet"><link href="https://www.justinpurnell.com/BusinessMath/week-05/02-tue-investment-analysis" rel="canonical"><link href="/feed.rss" rel="alternate" type="application/rss+xml" title="Justin Purnell"><meta property="og:site_name" content="Justin Purnell"><meta property="og:title" content="Investment Analysis with NPV and IRR"><meta property="twitter:title" content="Investment Analysis with NPV and IRR"><meta property="og:description" content="Investment Analysis with NPV and IRR"><meta name="twitter:description" content="Investment Analysis with NPV and IRR"><meta property="og:url" content="https://www.justinpurnell.com/BusinessMath/week-05/02-tue-investment-analysis"><meta name="twitter:domain" content="justinpurnell.com"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:dnt" content="on"><meta name="description" content="**Entrepreneurial Strategist & Builder:** Justin Purnell is the Founder of **Ledge Partners**, dedicated to acquiring and leading profitable businesses. His foundation is built on seven years at **Goldman Sachs** as a high yield credit analyst, where he published over **400 research reports** and advised C-level executives.
**Product Innovation and Scale:** He led the complete **re-platforming of technology supporting over 70 e-commerce sites** globally as Head of Product at **Hotels at Home**. He actively builds technical solutions, including pioneering **AI-powered software** to automate product data generation and designing a Swift middleware prototype that cut vendor onboarding time from **four months to two weeks**.
**Driving Financial and Organizational Results:** At **NBCUniversal's Seeso**, he directed product operations and retention initiatives that resulted in a **40% increase in customer Lifetime Value**. He is adept at mobilizing cross-functional teams, having successfully stepped in to **referee a dispute** between NBC and a third-party vendor to foster consensus and launch the Content Commerce platform.
**Creative and Governance Leadership:** Justin combines corporate rigor with creative experience, having directed the Webby-awarded web series **Smart Girls at the Party** and serving as a founding producer for **UCBcomedy.com**. He maintains significant governance roles, including serving as **President of the Princeton University Class of 2000** (1,143 alumni) and managing its annual giving campaigns."><meta name="fediverse:creator" content="@jpurnell@mastodon.social"><meta name="tags" content="Product Manager, Strategy, Product Leader, Goldman Sachs, NBCUniversal, Hotels at Home, AI, LLM, Digital Transformation, e-commerce, Swift, Consensus Leadership, Leadership, Agile, DevOps, Continuous Integration, Continuous Deployment, Cloud, Data Science, Machine Learning, Python, JavaScript, Front-end, Back-end, Full-stack, Responsive Design, Accessibility, SEO, Content Strategy, User Experience, User Interface, Design, Agile, Product Strategy, Technical Strategy"><script>	(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-K3TZS8J');</script><link href="/css/main.css" rel="stylesheet"></head><body><div class="col-sm-10 mx-auto"><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K3TZS8J"
	height="0" width="0" style="display:none;visibility:hidden"></iframe>
<header><nav class="noPrint navbar navbar-expand-md" style="border-bottom: 0.01em solid #d5d5d5;"><div class="container-fluid col"><button type="button" class="navbar-toggler btn" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div id="navbarCollapse" class="collapse navbar-collapse"><ul class="navbar-nav mb-2 mb-md-0 col"><li class="nav-item"><a href="/" class="nav-link">Home</a></li><li class="nav-item"><a href="/about" class="nav-link">About</a></li><li class="nav-item"><a href="/cv" class="nav-link">CV</a></li><li class="nav-item"><a href="/business-math" class="nav-link">BusinessMath</a></li><li class="nav-item"><a href="/next" class="nav-link">NeXT</a></li></ul></div></div></nav></header><div class="row"><div class="col"><h1 class="mainTitle">Investment Analysis with NPV and IRR</h1><div style="margin-bottom: 2em"><p class="blogDateTime" style="margin-left: 1em">BusinessMath Quarterly Series</p><p class="blogDateTime" style="margin-left: 1em">15 min read</p></div><p class="mx-auto blurb" style="width: 70%; max-width: 800px"><p><strong>Part 17 of 12-Week BusinessMath Series</strong></p><hr /><h2>What You‚Äôll Learn</h2><ul><li>Calculating Net Present Value (NPV) for investment decisions</li><li>Determining Internal Rate of Return (IRR) to measure returns</li><li>Using XNPV and XIRR for irregular cash flow timing</li><li>Computing profitability index and payback periods</li><li>Performing sensitivity analysis on key assumptions</li><li>Comparing multiple investment opportunities systematically</li><li>Making risk-adjusted investment decisions using CAPM</li></ul><hr /><h2>The Problem</h2><p>Every business faces investment decisions: <strong>Should we expand into a new market? Buy this equipment? Acquire that company?</strong> Bad investment decisions destroy value:</p><ul><li><strong>How do you compare investments with different sizes?</strong> $1M investment returning $1.2M vs. $100K returning $130K?</li><li><strong>What if cash flows arrive at irregular times?</strong> Real estate projects don‚Äôt have annual cash flows.</li><li><strong>How do you account for risk?</strong> A startup investment should require higher returns than treasury bonds.</li><li><strong>Which metric is most important?</strong> NPV, IRR, payback period, or profitability index?</li></ul><p><strong>Spreadsheet investment analysis is error-prone and doesn‚Äôt scale when evaluating dozens of opportunities.</strong></p><hr /><h2>The Solution</h2><p>BusinessMath provides comprehensive investment analysis functions: <code>npv()</code>, <code>irr()</code>, <code>xnpv()</code>, <code>xirr()</code>, plus supporting metrics like profitability index and payback periods.</p><h3>Define the Investment</h3><p>Let‚Äôs analyze a rental property investment:</p><pre><code class="language-swift">import BusinessMath
import Foundation

// Rental property opportunity
let propertyPrice = 250_000.0
let downPayment = 50_000.0      // 20% down
let renovationCosts = 20_000.0
let initialInvestment = downPayment + renovationCosts  // $70,000

// Expected annual cash flows (after expenses and mortgage)
let year1 = 8_000.0
let year2 = 8_500.0
let year3 = 9_000.0
let year4 = 9_500.0
let year5 = 10_000.0
let salePrice = 300_000.0       // Sell after 5 years
let mortgagePayoff = 190_000.0
let saleProceeds = salePrice - mortgagePayoff  // Net: $110,000

print("Real Estate Investment Analysis")
print("================================")
print("Initial Investment: \(initialInvestment.currency(0))")
print("  Down Payment: \(downPayment.currency(0))")
print("  Renovations: \(renovationCosts.currency(0))")
print("\nExpected Cash Flows:")
print("  Years 1-5: Annual rental income")
print("  Year 5: + Sale proceeds (\(saleProceeds.currency(0)))")
print("  Required Return: 12%")
</code></pre><p><strong>Output:</strong></p><pre><code>Real Estate Investment Analysis
================================
Initial Investment: $70,000
  Down Payment: $50,000
  Renovations: $20,000

Expected Cash Flows:
  Years 1-5: Annual rental income
  Year 5: + Sale proceeds ($110,000)
  Required Return: 12%
</code></pre><hr /><h3>Calculate NPV</h3><p>Determine if the investment creates value at your required return:</p><pre><code class="language-swift">// Define all cash flows
let cashFlows = [
    -initialInvestment,  // Year 0: Outflow
    year1,               // Year 1: Rental income
    year2,               // Year 2
    year3,               // Year 3
    year4,               // Year 4
    year5 + saleProceeds // Year 5: Rental + sale
]

let requiredReturn = 0.12
let npvValue = npv(discountRate: requiredReturn, cashFlows: cashFlows)

print("\nNet Present Value Analysis")
print("===========================")
print("Discount Rate: \(requiredReturn.percent())")
print("NPV: \(npvValue.currency(0))")

if npvValue > 0 {
    print("‚úì Positive NPV - Investment adds value")
    print("  For every $1 invested, you create \((1 + npvValue / initialInvestment).currency(2)) of value")
} else if npvValue < 0 {
    print("‚úó Negative NPV - Investment destroys value")
    print("  Should reject this opportunity")
} else {
    print("‚óã Zero NPV - Breakeven investment")
}
</code></pre><p><strong>Output:</strong></p><pre><code>Net Present Value Analysis
===========================
Discount Rate: 12.00%
NPV: $24,454
‚úì Positive NPV - Investment adds value
  For every $1 invested, you create $1.35 of value
</code></pre><p><strong>The decision rule</strong>: <strong>NPV > 0 means accept</strong>. This investment creates $24,454 of value at your 12% required return.</p><hr /><h3>Calculate IRR</h3><p>Find the actual return rate of the investment:</p><pre><code class="language-swift">let irrValue = try irr(cashFlows: cashFlows)

print("\nInternal Rate of Return")
print("=======================")
print("IRR: \(irrValue.percent(2))")
print("Required Return: \(requiredReturn.percent())")

if irrValue > requiredReturn {
    let spread = (irrValue - requiredReturn) * 100
    print("‚úì IRR exceeds required return by \(spread.number(2)) percentage points")
    print("  Investment is attractive")
} else if irrValue < requiredReturn {
    let shortfall = (requiredReturn - irrValue) * 100
    print("‚úó IRR falls short by \(shortfall.number(2)) percentage points")
} else {
    print("‚óã IRR equals required return - Breakeven")
}

// Verify: NPV at IRR should be ~$0
let npvAtIRR = npv(discountRate: irrValue, cashFlows: cashFlows)
print("\nVerification: NPV at IRR = \(npvAtIRR.currency()) (should be ~$0)")
</code></pre><p><strong>Output:</strong></p><pre><code>Internal Rate of Return
=======================
IRR: 20.24%
Required Return: 12.00%
‚úì IRR exceeds required return by 8.24 percentage points
  Investment is attractive

Verification: NPV at IRR = $0.00 (should be ~$0)```

**The insight**: The investment returns **22.83%**, well above the 12% hurdle rate. IRR is the discount rate that makes NPV = $0.

---

### Additional Investment Metrics

Calculate supporting metrics for a complete picture:

```swift
// Profitability Index
let pi = profitabilityIndex(rate: requiredReturn, cashFlows: cashFlows)

print("\nProfitability Index")
print("===================")
print("PI: \(pi.number(2))")
if pi > 1.0 {
    print("‚úì PI > 1.0 - Creates value")
    print("  Returns \(pi.currency(2)) for every $1 invested")
} else {
    print("‚úó PI < 1.0 - Destroys value")
}

// Payback Period
let payback = paybackPeriod(cashFlows: cashFlows)

print("\nPayback Period")
print("==============")
if let pb = payback {
    print("Simple Payback: \(pb) years")
    print("  Investment recovered in year \(pb)")
} else {
    print("Investment never recovers initial outlay")
}

// Discounted Payback
let discountedPayback = discountedPaybackPeriod(
    rate: requiredReturn,
    cashFlows: cashFlows
)

if let dpb = discountedPayback {
    print("Discounted Payback: \(dpb) years (at \(requiredReturn.percent()))")
    if let pb = payback {
        let difference = dpb - pb
        print("  Takes \(difference) more years accounting for time value")
    }
}
</code></pre><p><strong>Output:</strong></p><pre><code>Profitability Index
===================
PI: 1.35
‚úì PI > 1.0 - Creates value
  Returns $1.35 for every $1 invested

Payback Period
==============
Simple Payback: 5 years
  Investment recovered in year 5

Discounted Payback: 5 years (at 12.00%)
  Takes 0 more years accounting for time value
</code></pre><p><strong>The metrics</strong>:</p><ul><li><strong>PI = 1.35</strong>: Every dollar invested returns $1.35 in present value</li><li><strong>Payback = 5 years</strong>: Break even at the end (due to large sale proceeds)</li></ul><hr /><h3>Sensitivity Analysis</h3><p>Test how changes in assumptions affect the decision:</p><pre><code class="language-swift">print("\nSensitivity Analysis")
print("====================")

// Test different discount rates
print("NPV at Different Discount Rates:")
print("Rate  | NPV        | Decision")
print("------|------------|----------")

for rate in stride(from: 0.08, through: 0.16, by: 0.02) {
    let npv = npv(discountRate: rate, cashFlows: cashFlows)
    let decision = npv > 0 ? "Accept" : "Reject"
    print("\(rate.percent(0)) | \(npv.currency()) | \(decision)")
}

// Test different sale prices
print("\nNPV at Different Sale Prices:")
print("Sale Price | Net Proceeds | NPV        | Decision")
print("-----------|--------------|------------|----------")

for price in stride(from: 240_000.0, through: 340_000.0, by: 20_000.0) {
    let proceeds = price - mortgagePayoff
    let flows = [-initialInvestment, year1, year2, year3, year4, year5 + proceeds]
    let npv = npv(discountRate: requiredReturn, cashFlows: flows)
    let decision = npv > 0 ? "Accept" : "Reject"
    print("\(price.currency(0)) | \(proceeds.currency(0)) | \(npv.currency()) | \(decision)")
}
</code></pre><p><strong>Output:</strong></p><pre><code>Sensitivity Analysis
====================
NPV at Different Discount Rates:
Rate  | NPV        | Decision
------|------------|----------
   8% |    $40,492 | Accept
  10% |    $32,059 | Accept
  12% |    $24,454 | Accept
  14% |    $17,582 | Accept
  16% |    $11,360 | Accept

NPV at Different Sale Prices:
Sale Price | Net Proceeds | NPV        | Decision
-----------|--------------|------------|----------
  $240,000 |      $50,000 |   ($9,592) | Reject
  $260,000 |      $70,000 |     $1,757 | Accept
  $280,000 |      $90,000 |    $13,105 | Accept
  $300,000 |     $110,000 |    $24,454 | Accept
  $320,000 |     $130,000 |    $35,802 | Accept
  $340,000 |     $150,000 |    $47,151 | Accept
</code></pre><p><strong>The risk assessment</strong>: The investment is <strong>sensitive to sale price</strong>. If the property sells for < ~$260k, NPV turns negative. This is your <strong>margin of safety</strong>.</p><hr /><h3>Breakeven Analysis</h3><p>Find the exact breakeven sale price where NPV = $0:</p><pre><code class="language-swift">print("\nBreakeven Analysis:")

var low = 200_000.0
var high = 350_000.0
var breakeven = (low + high) / 2

// Binary search for breakeven
for _ in 0..<20 {
    let proceeds = breakeven - mortgagePayoff
    let flows = [-initialInvestment, year1, year2, year3, year4, year5 + proceeds]
    let npv = npv(discountRate: requiredReturn, cashFlows: flows)

    if abs(npv) < 1.0 { break }  // Close enough
    else if npv > 0 { high = breakeven }
    else { low = breakeven }

    breakeven = (low + high) / 2
}

print("Breakeven Sale Price: \(breakeven.currency(0))")
print("  At this price, NPV = $0 and IRR = \(requiredReturn.percent())")
print("  Current assumption: \(salePrice.currency(0))")
print("  Safety margin: \((salePrice - breakeven).currency(0)) (\(((salePrice - breakeven) / salePrice).percent(1)))")
</code></pre><p><strong>Output:</strong></p><pre><code>Breakeven Analysis:
Breakeven Sale Price: $256,905
  At this price, NPV = $0 and IRR = 12.00%
  Current assumption: $300,000
  Safety margin: $43,095 (14.4%)
</code></pre><p><strong>The cushion</strong>: The property can drop <strong>$43k (14.4%)</strong> from your expected sale price before the investment turns negative.</p><hr /><h3>Compare Multiple Investments</h3><p>Rank several opportunities systematically:</p><pre><code class="language-swift">print("\nComparing Investment Opportunities")
print("===================================")

struct Investment {
    let name: String
    let cashFlows: [Double]
    let description: String
}

let investments = [
    Investment(
        name: "Real Estate",
        cashFlows: [-70_000, 8_000, 8_500, 9_000, 9_500, 120_000],
        description: "Rental property with 5-year hold"
    ),
    Investment(
        name: "Stock Portfolio",
        cashFlows: [-70_000, 5_000, 5_500, 6_000, 6_500, 75_000],
        description: "Diversified equity portfolio"
    ),
    Investment(
        name: "Business Expansion",
        cashFlows: [-70_000, 0, 10_000, 15_000, 20_000, 40_000],
        description: "Expand product line (delayed returns)"
    )
]

print("\nInvestment        | NPV       | IRR     | PI   | Payback")
print("------------------|-----------|---------|------|--------")

var results: [(name: String, npv: Double, irr: Double)] = []

for investment in investments {
    let npv = npv(discountRate: requiredReturn, cashFlows: investment.cashFlows)
    let irr = try irr(cashFlows: investment.cashFlows)
    let pi = profitabilityIndex(rate: requiredReturn, cashFlows: investment.cashFlows)
    let pb = paybackPeriod(cashFlows: investment.cashFlows) ?? 99

    results.append((investment.name, npv, irr))
    print("\(investment.name.padding(toLength: 17, withPad: " ", startingAt: 0)) | \(npv.currency(0)) | \(irr.percent(1)) | \(pi.number(2)) | \(pb) yrs")
}

// Rank by NPV
let ranked = results.sorted { $0.npv > $1.npv }

print("\nRanking by NPV:")
for (i, result) in ranked.enumerated() {
    print("  \(i + 1). \(result.name) - NPV: \(result.npv.currency(0))")
}

print("\nRecommendation: Choose '\(ranked[0].name)'")
print("  Highest NPV = Maximum value creation")
</code></pre><p><strong>Output:</strong></p><pre><code>Comparing Investment Opportunities
===================================

Investment        | NPV       | IRR     | PI   | Payback
------------------|-----------|---------|------|--------
Real Estate       |   $24,454 |   20.2% | 1.35 | 5 yrs
Stock Portfolio   | ($10,193) |    8.0% | 0.85 | 5 yrs
Business Expansio | ($15,944) |    4.9% | 0.77 | 5 yrs

Ranking by NPV:
  1. Real Estate - NPV: $24,454
  2. Stock Portfolio - NPV: ($10,193)
  3. Business Expansion - NPV: ($15,944)

Recommendation: Choose 'Real Estate'
  Highest NPV = Maximum value creation
</code></pre><p><strong>The decision</strong>: <strong>Real Estate has the highest NPV</strong>, creating $24,454 of value. Even though Business Expansion has a higher IRR than Stock Portfolio, Real Estate wins on absolute value creation.</p><hr /><h3>Irregular Cash Flow Analysis</h3><p>Use XNPV and XIRR for real-world irregular timing:</p><pre><code class="language-swift">print("\nIrregular Cash Flow Analysis")
print("============================")

let startDate = Date()
let dates = [
	startDate,                                     // Today: Initial investment
	startDate.addingTimeInterval(90 * 86400),     // 90 days
	startDate.addingTimeInterval(250 * 86400),    // 250 days
	startDate.addingTimeInterval(400 * 86400),    // 400 days
	startDate.addingTimeInterval(600 * 86400),    // 600 days
	startDate.addingTimeInterval(5 * 365 * 86400) // 5 years
]

let irregularFlows = [-70_000.0, 8_000, 8_500, 9_000, 9_500, 120_000]

// XNPV accounts for exact dates
let xnpvValue = try xnpv(rate: requiredReturn, dates: dates, cashFlows: irregularFlows)
print("XNPV (irregular timing): \(xnpvValue.currency())")

// XIRR finds return with irregular dates
let xirrValue = try xirr(dates: dates, cashFlows: irregularFlows)
print("XIRR (irregular timing): \(xirrValue.percent(2))")

// Compare to regular IRR (assumes annual periods)
let regularIRR = try irr(cashFlows: irregularFlows)
print("\nComparison:")
print("  Regular IRR (annual periods): \(regularIRR.percent(2))")
print("  XIRR (actual dates): \(xirrValue.percent(2))")
print("  Difference: \(((xirrValue - regularIRR) * 10000).number(0)) basis points")
</code></pre><p><strong>Output:</strong></p><pre><code>Irregular Cash Flow Analysis
============================
XNPV (irregular timing): $29,570.08
XIRR (irregular timing): 23.80%

Comparison:
  Regular IRR (annual periods): 20.24%
  XIRR (actual dates): 23.80%
  Difference: 356 basis points
</code></pre><p><strong>The precision</strong>: XIRR is <strong>more accurate</strong> for real-world investments where cash flows don‚Äôt arrive exactly annually.</p><hr /><h2>Try It Yourself</h2><details>
<summary>Click to expand full playground code</summary>
<pre><code class="language-swift">import BusinessMath
import Foundation

// Rental property opportunity
let propertyPrice = 250_000.0
let downPayment = 50_000.0      // 20% down
let renovationCosts = 20_000.0
let initialInvestment = downPayment + renovationCosts  // $70,000

// Expected annual cash flows (after expenses and mortgage)
let year1 = 8_000.0
let year2 = 8_500.0
let year3 = 9_000.0
let year4 = 9_500.0
let year5 = 10_000.0
let salePrice = 300_000.0       // Sell after 5 years
let mortgagePayoff = 190_000.0
let saleProceeds = salePrice - mortgagePayoff  // Net: $110,000

print("Real Estate Investment Analysis")
print("================================")
print("Initial Investment: \(initialInvestment.currency(0))")
print("  Down Payment: \(downPayment.currency(0))")
print("  Renovations: \(renovationCosts.currency(0))")
print("\nExpected Cash Flows:")
print("  Years 1-5: Annual rental income")
print("  Year 5: + Sale proceeds (\(saleProceeds.currency(0)))")
print("  Required Return: 12%")

// MARK: - Calculate NPV

	// Define all cash flows
	let cashFlows = [
		-initialInvestment,  // Year 0: Outflow
		year1,               // Year 1: Rental income
		year2,               // Year 2
		year3,               // Year 3
		year4,               // Year 4
		year5 + saleProceeds // Year 5: Rental + sale
	]

	let requiredReturn = 0.12
	let npvValue = npv(discountRate: requiredReturn, cashFlows: cashFlows)

	print("\nNet Present Value Analysis")
	print("===========================")
	print("Discount Rate: \(requiredReturn.percent())")
	print("NPV: \(npvValue.currency(0))")

	if npvValue > 0 {
		print("‚úì Positive NPV - Investment adds value")
		print("  For every $1 invested, you create \((1 + npvValue / initialInvestment).currency(2)) of value")
	} else if npvValue < 0 {
		print("‚úó Negative NPV - Investment destroys value")
		print("  Should reject this opportunity")
	} else {
		print("‚óã Zero NPV - Breakeven investment")
	}

// MARK: - Calculate IRR

let irrValue = try irr(cashFlows: cashFlows)

print("\nInternal Rate of Return")
print("=======================")
print("IRR: \(irrValue.percent(2))")
print("Required Return: \(requiredReturn.percent())")

if irrValue > requiredReturn {
	let spread = (irrValue - requiredReturn) * 100
	print("‚úì IRR exceeds required return by \(spread.number(2)) percentage points")
	print("  Investment is attractive")
} else if irrValue < requiredReturn {
	let shortfall = (requiredReturn - irrValue) * 100
	print("‚úó IRR falls short by \(shortfall.number(2)) percentage points")
} else {
	print("‚óã IRR equals required return - Breakeven")
}

// Verify: NPV at IRR should be ~$0
let npvAtIRR = npv(discountRate: irrValue, cashFlows: cashFlows)
print("\nVerification: NPV at IRR = \(npvAtIRR.currency()) (should be ~$0)")


// MARK: - Additional Investment Metrics

	// Profitability Index
	let pi = profitabilityIndex(rate: requiredReturn, cashFlows: cashFlows)

	print("\nProfitability Index")
	print("===================")
	print("PI: \(pi.number(2))")
	if pi > 1.0 {
		print("‚úì PI > 1.0 - Creates value")
		print("  Returns \(pi.currency(2)) for every $1 invested")
	} else {
		print("‚úó PI < 1.0 - Destroys value")
	}

	// Payback Period
	let payback = paybackPeriod(cashFlows: cashFlows)

	print("\nPayback Period")
	print("==============")
	if let pb = payback {
		print("Simple Payback: \(pb) years")
		print("  Investment recovered in year \(pb)")
	} else {
		print("Investment never recovers initial outlay")
	}

	// Discounted Payback
	let discountedPayback = discountedPaybackPeriod(
		rate: requiredReturn,
		cashFlows: cashFlows
	)

	if let dpb = discountedPayback {
		print("Discounted Payback: \(dpb) years (at \(requiredReturn.percent()))")
		if let pb = payback {
			let difference = dpb - pb
			print("  Takes \(difference) more years accounting for time value")
		}
	}

// MARK: - Sensitivity Analysis

print("\nSensitivity Analysis")
print("====================")

// Test different discount rates
print("NPV at Different Discount Rates:")
print("Rate  | NPV        | Decision")
print("------|------------|----------")

for rate in stride(from: 0.08, through: 0.16, by: 0.02) {
	let npv = npv(discountRate: rate, cashFlows: cashFlows)
	let decision = npv > 0 ? "Accept" : "Reject"
	print("\(rate.percent(0).paddingLeft(toLength: 5)) | \(npv.currency(0).paddingLeft(toLength: 10)) | \(decision)")
}

// Test different sale prices
print("\nNPV at Different Sale Prices:")
print("Sale Price | Net Proceeds | NPV        | Decision")
print("-----------|--------------|------------|----------")

for price in stride(from: 240_000.0, through: 340_000.0, by: 20_000.0) {
	let proceeds = price - mortgagePayoff
	let flows = [-initialInvestment, year1, year2, year3, year4, year5 + proceeds]
	let npv = npv(discountRate: requiredReturn, cashFlows: flows)
	let decision = npv > 0 ? "Accept" : "Reject"
	print("\(price.currency(0).paddingLeft(toLength: 10)) | \(proceeds.currency(0).paddingLeft(toLength: 12)) | \(npv.currency(0).paddingLeft(toLength: 10)) | \(decision)")
}

// MARK: - Breakeven Analysis

print("\nBreakeven Analysis:")

var low = 200_000.0
var high = 350_000.0
var breakeven = (low + high) / 2

// Binary search for breakeven
for _ in 0..<20 {
	let proceeds = breakeven - mortgagePayoff
	let flows = [-initialInvestment, year1, year2, year3, year4, year5 + proceeds]
	let npv = npv(discountRate: requiredReturn, cashFlows: flows)

	if abs(npv) < 1.0 { break }  // Close enough
	else if npv > 0 { high = breakeven }
	else { low = breakeven }

	breakeven = (low + high) / 2
}

print("Breakeven Sale Price: \(breakeven.currency(0))")
print("  At this price, NPV = $0 and IRR = \(requiredReturn.percent())")
print("  Current assumption: \(salePrice.currency(0))")
print("  Safety margin: \((salePrice - breakeven).currency(0)) (\(((salePrice - breakeven) / salePrice).percent(1)))")

// MARK: - Compare Multiple Investments

print("\nComparing Investment Opportunities")
print("===================================")

struct Investment {
	let name: String
	let cashFlows: [Double]
	let description: String
}

let investments = [
	Investment(
		name: "Real Estate",
		cashFlows: [-70_000, 8_000, 8_500, 9_000, 9_500, 120_000],
		description: "Rental property with 5-year hold"
	),
	Investment(
		name: "Stock Portfolio",
		cashFlows: [-70_000, 5_000, 5_500, 6_000, 6_500, 75_000],
		description: "Diversified equity portfolio"
	),
	Investment(
		name: "Business Expansion",
		cashFlows: [-70_000, 0, 10_000, 15_000, 20_000, 40_000],
		description: "Expand product line (delayed returns)"
	)
]

print("\nInvestment        | NPV       | IRR     | PI   | Payback")
print("------------------|-----------|---------|------|--------")

var results: [(name: String, npv: Double, irr: Double)] = []

for investment in investments {
	let npv = npv(discountRate: requiredReturn, cashFlows: investment.cashFlows)
	let irr = try irr(cashFlows: investment.cashFlows)
	let pi = profitabilityIndex(rate: requiredReturn, cashFlows: investment.cashFlows)
	let pb = paybackPeriod(cashFlows: investment.cashFlows) ?? 99

	results.append((investment.name, npv, irr))
	print("\(investment.name.padding(toLength: 17, withPad: " ", startingAt: 0)) | \(npv.currency(0).paddingLeft(toLength: 9)) | \(irr.percent(1).paddingLeft(toLength: 7)) | \(pi.number(2)) | \(pb) yrs")
}

// Rank by NPV
let ranked = results.sorted { $0.npv > $1.npv }

print("\nRanking by NPV:")
for (i, result) in ranked.enumerated() {
	print("  \(i + 1). \(result.name) - NPV: \(result.npv.currency(0))")
}

print("\nRecommendation: Choose '\(ranked[0].name)'")
print("  Highest NPV = Maximum value creation")

// MARK: - Irregular Cash Flow Analysis

print("\nIrregular Cash Flow Analysis")
print("============================")

let startDate = Date()
let dates = [
	startDate,                                     // Today: Initial investment
	startDate.addingTimeInterval(90 * 86400),     // 90 days
	startDate.addingTimeInterval(250 * 86400),    // 250 days
	startDate.addingTimeInterval(400 * 86400),    // 400 days
	startDate.addingTimeInterval(600 * 86400),    // 600 days
	startDate.addingTimeInterval(5 * 365 * 86400) // 5 years
]

let irregularFlows = [-70_000.0, 8_000, 8_500, 9_000, 9_500, 120_000]

// XNPV accounts for exact dates
let xnpvValue = try xnpv(rate: requiredReturn, dates: dates, cashFlows: irregularFlows)
print("XNPV (irregular timing): \(xnpvValue.currency())")

// XIRR finds return with irregular dates
let xirrValue = try xirr(dates: dates, cashFlows: irregularFlows)
print("XIRR (irregular timing): \(xirrValue.percent(2))")

// Compare to regular IRR (assumes annual periods)
let regularIRR = try irr(cashFlows: irregularFlows)
print("\nComparison:")
print("  Regular IRR (annual periods): \(regularIRR.percent(2))")
print("  XIRR (actual dates): \(xirrValue.percent(2))")
print("  Difference: \(((xirrValue - regularIRR) * 10000).number(0)) basis points")

</code></pre></details>
‚Üí Full API Reference: [**BusinessMath Docs ‚Äì 3.8 Investment Analysis**](https://github.com/jpurnell/BusinessMath/blob/main/Sources/BusinessMath/BusinessMath.docc/3.8-InvestmentAnalysis.md)
<p><strong>Modifications to try</strong>:</p><ol><li>Model your company‚Äôs capital project pipeline</li><li>Compare equipment purchase vs. lease</li><li>Calculate risk-adjusted NPV using CAPM</li><li>Build Monte Carlo simulation around key assumptions</li></ol><hr /><h2>Real-World Application</h2><p>Every CFO, investor, and analyst uses NPV/IRR daily:</p><ul><li><strong>Private equity</strong>: Evaluating buyout opportunities ($100M+)</li><li><strong>Startups</strong>: Deciding which product line to fund</li><li><strong>Corporate finance</strong>: Capital budgeting for factories, equipment</li><li><strong>Real estate</strong>: Property acquisition analysis</li></ul><p><strong>PE firm use case</strong>: ‚ÄúWe have 15 potential acquisitions. Rank them by NPV at our 15% hurdle rate. Show sensitivity to exit multiple (6x, 8x, 10x EBITDA).‚Äù</p><p>BusinessMath makes this analysis programmatic, reproducible, and portfolio-wide.</p><hr /><p><code>‚òÖ Insight ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</code></p><p><strong>Why NPV is Superior to IRR for Decision-Making</strong></p><p>IRR is intuitive (‚Äúthis investment returns 23%!‚Äù) but has flaws:</p><p><strong>Problem 1: Scale blindness</strong></p><ul><li>Project A: Invest $100, return $130 ‚Üí IRR = 30%</li><li>Project B: Invest $1M, return $1.2M ‚Üí IRR = 20%</li><li>IRR prefers A, but B creates $200k vs. $30k of value!</li></ul><p><strong>Problem 2: Multiple IRRs</strong></p><ul><li>Cash flows: [-100, +300, -250] ‚Üí Two IRRs exist (math breakdown)</li></ul><p><strong>Problem 3: Reinvestment assumption</strong></p><ul><li>IRR assumes you can reinvest cash flows at the IRR rate (unrealistic)</li><li>NPV assumes reinvestment at the discount rate (more reasonable)</li></ul><p><strong>The rule</strong>: Use <strong>NPV for decisions</strong> (maximizes value), <strong>IRR for communication</strong> (easy to understand).</p><p><code>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</code></p><hr /><h3>üìù Development Note</h3><p>The hardest implementation challenge was <strong>IRR convergence</strong>. IRR is calculated using Newton-Raphson iteration, which can fail if:</p><ul><li>Initial guess is far from the true IRR</li><li>Cash flows have multiple sign changes (multiple IRRs exist)</li><li>All cash flows have the same sign (no IRR exists)</li></ul><p>We implemented robust error handling with:</p><ol><li>Bisection fallback if Newton-Raphson diverges</li><li>Detection of multiple IRRs (warn user)</li><li>Clear error messages when no IRR exists</li></ol><p><strong>Related Methodology</strong>: <a href="../week-01/02-tue-test-first-development">Test-First Development</a> (Week 1) - We wrote tests for pathological cases (no IRR, multiple IRRs, near-zero cash flows) before implementing.</p><hr /><h2>Next Steps</h2><p><strong>Coming up tomorrow</strong>: Equity Valuation - Pricing stocks using dividend discount models, FCFE, and residual income.</p><p><strong>Thursday</strong>: Bond Valuation - Pricing bonds, credit spreads, and callable securities.</p><hr /><p><strong>Series Progress</strong>:</p><ul><li>Week: 5/12</li><li>Posts Published: 17/~48</li><li>Topics Covered: Foundation + Analysis + Operational + Financial Statements + Loans + Investments</li><li>Playgrounds: 16 available</li></ul></p><hr /><div style="margin-top: 2em"><p class="blurb" style="font-style: italic">Tagged with: businessmath, swift, npv, irr, investment-analysis, profitability-index, payback</p></div></div></div><header><nav class="noPrint navbar navbar-expand-md" style="border-top: 0.01em solid #d5d5d5;"><div class="container-fluid col"><button type="button" class="navbar-toggler btn" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div id="navbarCollapse" class="collapse navbar-collapse"><ul class="navbar-nav mb-2 mb-md-0 col"><li class="nav-item"><a href="mailto:morals.tech.0x@icloud.com" id="email" rel="me" target="_blank" class="nav-link">email</a></li><li class="nav-item"><a href="https://cal.com/jpurnell/15min" id="calendar" rel="me" target="_blank" class="nav-link">calendar</a></li><li class="nav-item"><a href="http://blog.justinpurnell.com" id="blog" rel="me" target="_blank" class="nav-link">blog</a></li><li class="nav-item"><a href="https://github.com/jpurnell" id="github" rel="me" target="_blank" class="nav-link">github</a></li><li class="nav-item"><a href="https://bsky.app/profile/justinpurnell.com" id="bsky" rel="me" target="_blank" class="nav-link">bsky</a></li><li class="nav-item"><a href="https://mastodon.social/@jpurnell" id="mastodon" rel="me" target="_blank" class="nav-link">mastodon</a></li><li class="nav-item"><a href="https://music.apple.com/us/station/justin-purnells-station/ra.u-a475786ae9cc432a1abb70ff757aa95f" id="radio" rel="me" target="_blank" class="nav-link">radio</a></li><li class="nav-item"><a href="https://www.justinpurnell.com/feed.rss" id="rss" rel="me" target="_blank" class="nav-link">rss</a></li><li class="nav-item"><a href="#" id="theme-toggle" rel="me" target="_blank" class="nav-link">theme</a></li></ul></div></div></nav></header><script src="/js/theme-toggle.js"></script></div><script src="/js/bootstrap.bundle.min.js"></script><script src="/js/syntax-highlighting.js"></script></body></html>